import 'dart:convert';

import 'package:boring_show/src/article.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;

void main() {
  test("parses top stories.json", () {
    const jsonString =
        "[20178255,20179820,20180015,20180319,20180599,20179529,20179203,20181070,20177157,20177877,20160025,20180974,20173203,20154285,20168388,20180387,20178267,20179667,20177593,20157968,20180071,20179794,20163845,20156816,20173558,20177565,20162388,20175304,20159629,20171459,20181246,20178799,20179706,20173675,20177025,20176523,20170966,20174418,20173549,20175211,20177673,20149215,20177500,20162381,20177766,20178489,20168936,20174683,20180529,20174062,20173974,20166724,20179675,20179073,20174308,20179257,20178672,20179566,20172797,20173603,20172749,20178156,20168314,20179690,20176058,20179638,20179221,20174502,20179169,20166455,20179308,20167686,20173215,20165787,20160693,20171311,20171446,20163464,20169191,20168770,20179729,20157116,20174241,20173830,20178953,20174847,20167867,20174006,20172150,20174055,20171563,20178597,20163389,20163243,20175043,20164062,20163304,20173304,20172674,20169503,20163500,20172214,20155636,20171060,20169577,20163774,20167529,20174000,20172238,20178717,20155639,20176274,20169104,20166891,20167586,20157809,20166070,20178486,20163495,20179511,20165839,20177262,20158386,20167618,20167106,20175084,20171676,20162959,20170827,20153306,20167313,20169635,20165254,20171646,20171388,20176406,20167310,20169628,20156168,20174020,20179847,20171413,20167750,20163975,20166131,20177224,20168285,20154750,20162199,20178549,20160634,20166369,20154481,20150652,20172408,20167762,20171967,20174930,20161841,20154181,20178133,20168019,20163530,20161902,20167779,20180018,20172345,20162918,20169092,20164822,20164531,20171046,20179094,20162015,20161549,20162169,20162261,20156842,20156090,20167949,20169744,20179485,20153210,20168840,20173504,20154289,20160718,20163157,20152534,20151055,20163734,20172340,20162087,20157196,20163278,20165821,20174694,20179009,20148771,20162006,20169516,20162473,20173861,20158266,20177158,20162763,20160667,20163467,20174184,20164809,20175273,20158418,20161445,20173995,20150688,20173886,20172524,20173846,20173657,20160013,20175772,20152493,20168926,20178584,20173353,20158167,20159153,20173739,20162418,20161337,20156815,20176847,20162470,20178369,20153472,20147764,20172275,20148308,20166806,20149665,20161637,20177319,20178159,20154327,20162777,20172803,20156285,20148600,20148022,20148588,20157291,20168343,20170016,20172632,20157017,20155608,20153313,20156836,20168411,20153128,20178742,20147989,20159216,20157931,20170853,20170847,20173534,20161214,20147884,20158039,20176270,20170597,20174652,20178100,20154255,20167787,20177202,20152197,20155098,20155248,20169990,20154303,20150749,20171740,20160478,20175610,20153123,20178153,20156158,20156425,20154372,20175329,20177646,20156640,20176697,20159926,20153868,20169175,20171482,20157882,20171393,20152608,20150230,20168670,20168450,20176297,20168347,20148956,20171173,20160662,20151755,20149800,20157524,20148428,20161078,20148639,20175896,20163705,20167246,20147808,20170514,20150179,20151803,20166431,20175352,20177156,20154513,20175180,20147930,20149779,20149415,20154210,20154529,20156923,20150813,20169777,20156297,20169444,20173852,20153567,20148787,20156065,20157472,20178754,20150192,20150658,20158420,20151569,20176221,20168221,20174085,20154382,20171264,20160342,20149439,20175929,20161868,20169918,20169357,20172744,20156108,20154020,20168023,20150431,20158918,20154583,20158004,20160809,20160314,20154424,20148378,20165321,20151882,20149304,20155859,20172967,20164096,20155595,20159039,20166791,20172840,20171946,20166529,20172751,20160852,20163477,20163419,20158042,20172683,20148865,20162152,20157684,20149263,20149527,20153353,20148942,20173219,20151401,20159602,20166240,20157661,20170536,20167483,20171438,20165560,20172290,20172284,20159860,20157525,20171336,20162434,20148954,20172119,20173300,20173292,20159081,20159067,20148609,20156735,20157523,20165607,20158126,20168839,20152727,20154378,20168546,20162611,20156148,20156002,20150737,20155553,20171263,20158995,20164051,20167040,20154366,20168981,20156750,20151912,20155020,20172176,20152218,20169348,20160499,20155073,20147881,20158845,20163328,20153340,20158062,20157604,20161211,20169638,20149988,20152686,20165054,20156182,20167143,20168577,20168545,20171265,20168378,20158309,20151085,20158000,20171045,20160955,20148189,20161362,20154207,20155995,20160537,20148541,20160473,20149377,20154165,20149111,20153073,20154265,20172673,20170241,20151280,20148346,20166912,20162789,20161460,20170979,20161091,20152335,20153865,20152074,20168641,20154441,20168508,20149437,20154817,20171968,20149189,20148621,20153713]";
    expect(parseTopStories(jsonString).first, 20178255);
  });

  test("parse item.json", () {
    const jsonString = """
    {"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8917,8952,8884,8887,8869,8958,8940,8908,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}
    """;

    expect(parseArticle(jsonString).by, "dhouston");
  });

  test("parse item overnetwork", () async {
    final urPrefix = "https://hacker-news.firebaseio.com/v0/";
    const urlTopStories = "beststories.json";

    final res = await http.get(urPrefix + urlTopStories);
    if (res.statusCode == 200) {
      final idListJson = parseTopStories(res.body);
      if (idListJson.isNotEmpty) {
        final storyUrl = urPrefix+"v0/item/${idListJson.first}.json";
        final storyRes = await http.get(storyUrl);
        if (storyRes.statusCode == 200) {
          expect(parseArticle(storyRes.body), isNotNull);
        }
      }
    } else {}
  },skip: true);
}
